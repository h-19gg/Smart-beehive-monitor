<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø®Ù„ÙŠØ© Ø§Ù„Ù†Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        :root { --primary: #2E8B57; --secondary: #FF6B35; --accent: #4ECDC4; --dark: #1A1A2E; --light: #F8F9FA; }
        body { background: linear-gradient(135deg, var(--dark) 0%, #16213E 100%); color: var(--light); min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; padding: 30px 0; background: linear-gradient(135deg, rgba(46, 139, 87, 0.9) 0%, rgba(255, 107, 53, 0.8) 100%); border-radius: 20px; margin-bottom: 30px; }
        .main-title { font-size: 3em; font-weight: 700; margin-bottom: 10px; }
        .engineer-name { font-size: 1.2em; color: var(--accent); font-weight: 600; margin-top: 10px; }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .sensor-card { background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%); border-radius: 20px; padding: 30px; text-align: center; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .sensor-icon { font-size: 3.5em; margin-bottom: 20px; }
        .sensor-value { font-size: 3em; font-weight: 700; margin: 10px 0; background: linear-gradient(135deg, var(--accent), var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .status-bar { display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, rgba(46, 139, 87, 0.2) 0%, rgba(255, 107, 53, 0.2) 100%); padding: 20px 30px; border-radius: 15px; margin-top: 30px; backdrop-filter: blur(10px); }
        
        .history-section { background: rgba(255, 255, 255, 0.05); border-radius: 20px; padding: 25px; margin: 40px 0; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        table { width: 100%; border-collapse: collapse; background: rgba(255, 255, 255, 0.02); border-radius: 15px; overflow: hidden; }
        th { background: linear-gradient(135deg, var(--primary), var(--secondary)); padding: 15px; text-align: center; font-weight: 600; }
        td { padding: 15px; text-align: center; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        
        @media (max-width: 768px) {
            .status-bar { flex-direction: column; gap: 15px; text-align: center; }
            .main-title { font-size: 2.2em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="main-title">ğŸ Ù†Ø¸Ø§Ù… Ø®Ù„ÙŠØ© Ø§Ù„Ù†Ø­Ù„ Ø§Ù„Ø°ÙƒÙŠØ©</h1>
            <div class="engineer-name">Eng. Hussein Fahim Al_khazaali</div>
        </header>
        
        <div class="dashboard">
            <div class="sensor-card"><div class="sensor-icon">ğŸŒ¡ï¸</div><div class="sensor-value" id="temperature">--</div><div>Â°C</div></div>
            <div class="sensor-card"><div class="sensor-icon">ğŸ’§</div><div class="sensor-value" id="humidity">--</div><div>%</div></div>
            <div class="sensor-card"><div class="sensor-icon">âš–ï¸</div><div class="sensor-value" id="weight">--</div><div>kg</div></div>
            <div class="sensor-card"><div class="sensor-icon">ğŸ”‹</div><div class="sensor-value" id="battery">--</div><div>%</div></div>
        </div>

        <div class="history-section">
            <div style="font-size: 1.5em; margin-bottom: 25px; text-align: center; color: var(--accent); font-weight: 600;">ğŸ•’ Ø¢Ø®Ø± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª</div>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                        <th>ğŸŒ¡ï¸ Ø§Ù„Ø­Ø±Ø§Ø±Ø©</th>
                        <th>ğŸ’§ Ø§Ù„Ø±Ø·ÙˆØ¨Ø©</th>
                        <th>âš–ï¸ Ø§Ù„ÙˆØ²Ù†</th>
                        <th>ğŸ”‹ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</th>
                    </tr>
                </thead>
                <tbody id="readingsBody">
                    <tr><td colspan="5" style="text-align: center;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="status-bar">
            <div id="status">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            <div id="lastUpdate">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: --</div>
            <div id="readingsCount">Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª: 0</div>
        </div>
    </div>

    <script>
        // ğŸ”’ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase Ø§Ù„Ø¢Ù…Ù†Ø©
        const SUPABASE_CONFIG = {
            url: 'https://xtbnjqfactpytowjtzfj.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh0Ym5qcWZhY3RweXRvd2p0emZqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNzQ4NDgsImV4cCI6MjA3Nzg1MDg0OH0.W0gI5_dshGOm7qsVc_h0X7qHpbbsawpQW2Wy74PpUgg'
        };

        // ğŸ”Œ ØªÙ‡ÙŠØ¦Ø© Supabase
        const supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);

        // ğŸ“Š Ø¬Ù„Ø¨ Ø£Ø­Ø¯Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function getLatestData() {
            try {
                const { data, error } = await supabase
                    .from('sensor_readings')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(1)
                    .single();

                if (error) throw error;
                return data;
            } catch (error) {
                console.log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                return null;
            }
        }

        // ğŸ“‹ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©
        async function getHistoryData() {
            try {
                const { data, error } = await supabase
                    .from('sensor_readings')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(10);

                if (error) throw error;
                return data;
            } catch (error) {
                console.log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®:', error);
                return [];
            }
        }

        // ğŸ¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        async function updateDashboard() {
            const latestData = await getLatestData();
            const historyData = await getHistoryData();

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            if (latestData) {
                document.getElementById('temperature').textContent = latestData.temperature?.toFixed(1) || '--';
                document.getElementById('humidity').textContent = latestData.humidity?.toFixed(1) || '--';
                document.getElementById('weight').textContent = latestData.weight?.toFixed(1) || '--';
                document.getElementById('battery').textContent = latestData.battery?.toFixed(1) || '--';
                
                document.getElementById('status').innerHTML = 'âœ… Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                document.getElementById('lastUpdate').textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date(latestData.created_at).toLocaleTimeString('ar-SA')}`;
            } else {
                document.getElementById('status').innerHTML = 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹';
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const tbody = document.getElementById('readingsBody');
            document.getElementById('readingsCount').textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª: ${historyData.length}`;
            
            if (historyData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</td></tr>';
            } else {
                tbody.innerHTML = historyData.map(reading => `
                    <tr>
                        <td>${new Date(reading.created_at).toLocaleString('ar-SA')}</td>
                        <td>${reading.temperature}Â°C</td>
                        <td>${reading.humidity}%</td>
                        <td>${reading.weight}kg</td>
                        <td>${reading.battery}%</td>
                    </tr>
                `).join('');
            }
        }

        // ğŸ”„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function startAutoUpdate() {
            updateDashboard(); // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ
            setInterval(updateDashboard, 5000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
        }

        // ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', startAutoUpdate);
    </script>
</body>
</html>
